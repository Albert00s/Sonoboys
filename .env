-- =====================================================
-- BANCO DE DADOS
-- =====================================================
DROP DATABASE IF EXISTS igreja_sonoplastia;

CREATE DATABASE igreja_sonoplastia
CHARACTER SET utf8mb4
COLLATE utf8mb4_unicode_ci;

USE igreja_sonoplastia;

-- =====================================================
-- TABELA DE ENVIOS (QUEM VAI CANTAR)
-- =====================================================
CREATE TABLE envios (
    id INT AUTO_INCREMENT PRIMARY KEY,

    grupo ENUM(
        'irmas',
        'criancas',
        'juventude',
        'louvor',
        'louvor_irmas',
        'visitante'
    ) NOT NULL,

    nome_visitante VARCHAR(150) NULL,

    data_envio TIMESTAMP DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB;

-- =====================================================
-- TABELA DE MÚSICAS
-- =====================================================
CREATE TABLE musicas (
    id INT AUTO_INCREMENT PRIMARY KEY,

    envio_id INT NOT NULL,

    titulo VARCHAR(200) NOT NULL,

    tipo ENUM('arquivo', 'link') NOT NULL,

    -- caminho do arquivo (ex: uploads/musicas/arquivo.mp3)
    arquivo VARCHAR(255) NULL,

    -- link externo (YouTube, Drive, etc)
    link VARCHAR(255) NULL,

    playback TINYINT(1) NOT NULL DEFAULT 0,

    -- NOVOS CAMPOS
    tocada TINYINT(1) NOT NULL DEFAULT 0,

    observacao TEXT NULL,

    ordem INT NOT NULL DEFAULT 0,

    criado_em TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

    CONSTRAINT fk_envio_musica
        FOREIGN KEY (envio_id)
        REFERENCES envios(id)
        ON DELETE CASCADE
) ENGINE=InnoDB;

-- =====================================================
-- ÍNDICES (PERFORMANCE)
-- =====================================================
CREATE INDEX idx_musicas_envio   ON musicas(envio_id);
CREATE INDEX idx_musicas_ordem   ON musicas(ordem);
CREATE INDEX idx_musicas_tocada  ON musicas(tocada);
CREATE INDEX idx_envios_data     ON envios(data_envio);


Porta=3308
